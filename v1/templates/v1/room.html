{% extends "v1/layout.html" %}
{% load static %}
{% block title %}
Room | Results
{% endblock %}
{% block body %}

<body>
  <div class="header_title">
    <img
      src="{% static 'v1/room.png' %}"
      class="header_logo_right"
    />
    <h1>results</h1>
    <input type="hidden" id="name" value="{{ name }}">
  </div>

  <div id="waitingContainer" class="waitingContainer">
    <img
      id="roomLogo"
      class="roomLogo"
      src="{% static 'v1/logo.png' %}"
    />
    <div id="messageSender" class="message">
      Come back later, {{ room.user_name }} still hasn't replied.
    </div>
    <div id="messageReceiver" class="message">
      Come back later, {{ room.other_person_name }} still hasn't replied.
    </div>
  </div>

  <div class="carousel" id="carouselSender">
    <div class="carousel-slides">
        {% for question in questions %}
        <div class="carousel-slide">
            <h1>{{ question.question}}</h1>
            <div style="display: flex; justify-content: space-evenly; height: 35vh;">
              <div style="display: flex; flex-direction: column; justify-content: space-evenly;">
                <div>
                  <h2 style="color: black;">{{ room.other_person_name }}'s reply</h2>
                  <p>{{ question.other_b }}</p>
                </div>
                <div>
                  <h4 style="color: black; font-weight: 500;">Your guess on {{ room.other_person_name }}</h4>
                  <p>{{ question.other_a }}</p>
                </div>
              </div>
              <div style="display: flex; flex-direction: column; justify-content: space-evenly;">
                <div>
                  <h2 style="color: black;">{{ room.other_person_name }}'s guess on you</h2>
                  <p>{{ question.other_b }}</p>
                </div>
                <div>
                  <h4 style="color: black; font-weight: 500;">Your reply on yourself</h4>
                  <p>{{ question.self_a }}</p>
                </div>
              </div>
            </div> 
        </div>
        {% endfor %}
    </div>
    <button class="slideButton prev" onclick="moveSlide(-1, 'carouselSender')">&#10094;</button>
    <button class="slideButton next" onclick="moveSlide(1, 'carouselSender')">&#10095;</button>
  </div>

  <div class="carousel" id="carouselReceiver">
    <div class="carousel-slides">
        {% for question in questions %}
        <div class="carousel-slide">
            <h1>{{ question.question}}</h1>
            <div style="display: flex; justify-content: space-evenly; height: 35vh;">
              <div style="display: flex; flex-direction: column; justify-content: space-evenly;">
                <div>
                  <h2 style="color: black;">{{ room.user_name }}'s reply</h2>
                  <p>{{ question.other_a }}</p>
                </div>
                <div>
                  <h4 style="color: black; font-weight: 500;">Your guess on {{ room.user_name }}</h4>
                  <p>{{ question.other_b }}</p>
                </div>
              </div>
              <div style="display: flex; flex-direction: column; justify-content: space-evenly;">
                <div>
                  <h2 style="color: black;">{{ room.user_name }}'s guess on you</h2>
                  <p>{{ question.other_a }}</p>
                </div>
                <div>
                  <h4 style="color: black; font-weight: 500;">Your reply on yourself</h4>
                  <p>{{ question.self_b }}</p>
                </div>
              </div>
            </div> 
        </div>
        {% endfor %}
    </div>
    <button class="slideButton prev" onclick="moveSlide(-1, 'carouselReceiver')">&#10094;</button>
    <button class="slideButton next" onclick="moveSlide(1, 'carouselReceiver')">&#10095;</button>
  </div>

  <a href="{% url 'create' %}" class="createNew" id="createNewButton">
    Create a new one!
  </a>
  <a href="" class="createNew" id="reminderButton">Send reminder</a>

  <script>
    document.addEventListener('DOMContentLoaded', (event) => {
        // Get name of who is entering, and the name's of sender and receiver for the room
        const name = document.getElementById('name').value;
        const sender = "{{ room.user_name }}";
        const receiver = "{{ room.other_person_name }}";

        // Get completeness status for sender and receiver
        const completenessSender = "{{ completeness.sender_completed }}";
        const completenessReceiver = "{{ completeness.receiver_completed }}";

        // If both have already replied
        if (completenessSender === "True" && completenessReceiver === "True") {
            // Hide anything related to the "waiting" animation
            document.getElementById("waitingContainer").classList.add("hidden");
            document.getElementById("roomLogo").classList.add("hidden");
            document.getElementById("reminderButton").classList.add("hidden");
            document.getElementById("createNewButton").classList.remove("hidden");
            document.getElementById("messageSender").classList.add("hidden");
            document.getElementById("messageReceiver").classList.add("hidden");
            // Show personalized carousel for sender
            if (name === sender) {
            document.getElementById("carouselSender").classList.remove("hidden");
            document.getElementById("carouselReceiver").classList.add("hidden");
            // Show personalized carousel for receiver
            } else if (name === receiver) {
            document.getElementById("carouselSender").classList.add("hidden");
            document.getElementById("carouselReceiver").classList.remove("hidden");
            }
        // If one of them hasn't already replied
        // We can safely assume the one accesing this page is the one how HAS replied
        } else if (completenessSender === "False" || completenessReceiver === "False") {
            // Hide all carousel related content
            document.getElementById("roomLogo").classList.remove("hidden");
            document.getElementById("waitingContainer").classList.remove("hidden");
            document.getElementById("reminderButton").classList.remove("hidden");
            document.getElementById("createNewButton").classList.add("hidden");
            document.getElementById("carouselSender").classList.add("hidden");
            document.getElementById("carouselReceiver").classList.add("hidden");
            // Show personalized waiting message for sender
            if (name === sender) {
            document.getElementById("messageSender").classList.add("hidden");
            document.getElementById("messageReceiver").classList.remove("hidden");
            // Show personalized waiting message for receiver
            } else if (name === receiver) {
            document.getElementById("messageSender").classList.remove("hidden");
            document.getElementById("messageReceiver").classList.add("hidden");
            }
        }
    });

    let currentSlideSender = 0;
    let currentSlideReceiver = 0;

    function moveSlide(direction, carouselId) {
        const carousel = document.querySelector(`#${carouselId} .carousel-slides`);
        const slides = carousel.querySelectorAll('.carousel-slide');
        const totalSlides = slides.length;

        let currentSlide = carouselId === 'carouselSender' ? currentSlideSender : currentSlideReceiver;
        currentSlide = (currentSlide + direction + totalSlides) % totalSlides;

        const offset = -currentSlide * 100;
        carousel.style.transform = `translateX(${offset}%)`;

        if (carouselId === 'carouselSender') {
            currentSlideSender = currentSlide;
        } else {
            currentSlideReceiver = currentSlide;
        }
    }
  </script>
</body>

{% endblock %}
